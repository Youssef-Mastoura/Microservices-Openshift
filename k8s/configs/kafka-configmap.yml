apiVersion: v1
kind: ConfigMap
metadata:
  name: kafka-config
  namespace: microservices
data:
  # Kafka Configuration
  KAFKA_ZOOKEEPER_CONNECT: "zookeeper:2181"
  KAFKA_LISTENERS: "SASL_SSL://0.0.0.0:9092"
  KAFKA_ADVERTISED_LISTENERS: "SASL_SSL://kafka-cluster:9092"
  KAFKA_AUTO_CREATE_TOPICS_ENABLE: "true"
  KAFKA_SASL_ENABLED_MECHANISMS: "PLAIN"
  KAFKA_SASL_MECHANISM_INTER_BROKER_PROTOCOL: "PLAIN"
  KAFKA_SECURITY_INTER_BROKER_PROTOCOL: "SASL_SSL"
  KAFKA_SSL_CLIENT_AUTH: "required"
  KAFKA_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM: ""
  KAFKA_SSL_KEYSTORE_LOCATION: /etc/kafka/secrets/kafka.server.keystore.jks
  KAFKA_SSL_KEY_PASSWORD: "kafka123"
  KAFKA_SSL_KEYSTORE_PASSWORD: "kafka123"
  KAFKA_SSL_TRUSTSTORE_LOCATION: /etc/kafka/secrets/kafka.server.truststore.jks
  KAFKA_SSL_TRUSTSTORE_PASSWORD: "kafka123"
  KAFKA_AUTHORIZER_CLASS_NAME: "kafka.security.authorizer.AclAuthorizer"
  KAFKA_ALLOW_EVERYONE_IF_NO_ACL_FOUND: "true"
  ZOOKEEPER_SASL_ENABLED: "true"
  KAFKA_ZOOKEEPER_SET_ACL: "true"
  KAFKA_HEAP_OPTS: "-Xmx2g -Xms1g"
  
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: kafka-jaas-config
  namespace: microservices
data:
  kafka_server_jaas.conf: |
    KafkaServer {
        org.apache.kafka.common.security.plain.PlainLoginModule required
        username="admin"
        password="admin-secret"
        user_admin="admin-secret"
        user_order-service="order-service-secret"
        user_user-service="user-service-secret"
        user_kafka-exporter="kafka-exporter-secret";
    };

    Client {
        org.apache.zookeeper.server.auth.DigestLoginModule required
        username="admin"
        password="admin-secret";
    };